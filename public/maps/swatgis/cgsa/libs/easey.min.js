(function(a,b){var c={},d,e={easeIn:function(a){return a*a},easeOut:function(a){return Math.sin(a*Math.PI/2)},linear:function(a){return a}};c.cancel=function(){d&&window.clearInterval(d)},c.sequence=function(a,b){function d(){}for(var e=0;e<b.length-1;e++){var f=b[e].callback||d;b[e].callback=function(d,e){return function(){e&&e(),c.slow(a,b[d])}}(e+1,f)}return c.slow(a,b[0])},c.cancel=function(){d&&window.clearInterval(d)},c.slow=function(a,c){d&&window.clearInterval(d);var f=+(new Date),g=a.getZoom(),h=a.getCenter(),j=a.coordinate.copy();typeof c=="number"?c={zoom:c}:c.lat&&typeof c.lat=="number"?c={location:c}:c.x&&typeof c.x=="number"&&(c={coordinate:a.pointCoordinate(c)}),c.point&&(c.coordinate=a.pointCoordinate(c.point)),z=c.zoom||g,time=c.time||1e3,callback=c.callback||function(){},ease=e[c.ease]||e.easeOut,d=window.setInterval(function(){var e=+(new Date)-f;if(e>time){a.setZoom(z),window.clearInterval(d);return callback()}var k=ease(e/time),l=z==g?z:g*(1-k)+z*k;if(c.location)a.setCenterZoom(b.Location.interpolate(h,c.location,k),l);else if(c.coordinate){var m=j.copy().zoomTo(l),n=c.coordinate.copy().zoomTo(l);a.coordinate=new b.Coordinate(m.row*(1-k)+n.row*k,m.column*(1-k)+n.column*k,l)}else c.zoom&&a.setZoom(l);a.draw()},1)},c.DoubleClickHandler=function(a){a!==undefined&&this.init(a)},c.DoubleClickHandler.prototype={init:function(a){this.map=a,b.addEvent(a.parent,"dblclick",this.getDoubleClick())},doubleClickHandler:null,getDoubleClick:function(){if(!this.doubleClickHandler){var a=this;this.doubleClickHandler=function(d){var e=a.map,f=e.pointLocation(b.getMousePoint(d,e)),g=e.getZoom()+(d.shiftKey?-1:1);c.slow(e,{zoom:g,pan:f},200);return b.cancelEvent(d)}}return this.doubleClickHandler}},c.MouseWheelHandler=function(a){a!==undefined&&this.init(a)},c.MouseWheelHandler.prototype={init:function(a){this.map=a,b.addEvent(a.parent,"mousewheel",this.getMouseWheel())},mouseWheelHandler:null,getMouseWheel:function(){if(!this.mouseWheelHandler){var a=this,d=(new Date).getTime();this.mouseWheelHandler=function(e){var f=0;e.wheelDelta?f=e.wheelDelta:e.detail&&(f=-e.detail);var g=(new Date).getTime()-d;if(Math.abs(f)>0&&g>200){var h=a.map,i=h.pointLocation(b.getMousePoint(e,h)),j=h.getZoom();c.slow(h,{zoom:j+(f>0?1:-1),pan:i},100),d=(new Date).getTime()}return b.cancelEvent(e)}}return this.mouseWheelHandler}},c.DragHandler=function(a){a!==undefined&&this.init(a)},c.DragHandler.prototype={init:function(a){this.map=a,b.addEvent(a.parent,"mousedown",b.bind(this.mouseDown,this))},mouseDown:function(a){b.addEvent(document,"mouseup",this._mouseUp=b.bind(this.mouseUp,this)),b.addEvent(document,"mousemove",this._mouseMove=b.bind(this.mouseMove,this)),this.lastMouse=b.getMousePoint(a,this.map),this.prevMouse=b.getMousePoint(a,this.map),this.map.parent.style.cursor="move";return b.cancelEvent(a)},mouseMove:function(a){if(this.prevMouse){var c=b.getMousePoint(a,this.map);this.map.panBy(c.x-this.prevMouse.x,c.y-this.prevMouse.y),this.lastMouse=new b.Point(this.prevMouse.x,this.prevMouse.y),this.prevMouse=b.getMousePoint(a,this.map),this.prevMouse.t=+(new Date)}return b.cancelEvent(a)},mouseUp:function(a){b.removeEvent(document,"mouseup",this._mouseUp),b.removeEvent(document,"mousemove",this._mouseMove);var d=Math.atan2(this.lastMouse.y-this.prevMouse.y,this.lastMouse.x-this.prevMouse.x),e=b.Point.distance(this.lastMouse,this.prevMouse),f=Math.min(Math.log(1+e/(+(new Date)-this.prevMouse.t))*90,300);if(!isNaN(d)){var g=this.map.coordinatePoint(this.map.coordinate),h=this.map.pointLocation(new b.Point(g.x+Math.cos(d)*f,g.y+Math.sin(d)*f));c.slow(this.map,{pan:h},f/100),this.prevMouse=null,this.map.parent.style.cursor="";return b.cancelEvent(a)}}},this.easey=c})(this,com.modestmaps)